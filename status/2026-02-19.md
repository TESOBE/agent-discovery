# Agent Discovery Status Report - 2026-02-19

## Summary

The full agent discovery pipeline is **working well end to end**. Two agents (`mumma1` on port 7313, `mumma2` on port 7314) successfully discover each other via audio chirps, negotiate a communication channel via Claude, establish TCP connections, and collaboratively explore OBP dynamic entities.

Version: `0.12.0`

---

## 1. Audio Chirp Discovery -- Working

- Each agent broadcasts FSK chirp hellos at a scheduled second of each minute (mumma1 at second 50, mumma2 at second 40)
- Different TX bands used per agent (band 1 vs band 2) to avoid collisions
- mumma1 heard mumma2's hello after ~29 seconds, decoding port 7314 and capabilities `TCP+OBP+Claude` from the audio signal
- mumma2 heard mumma1 ~10 seconds later
- Audio stats show healthy decoding: hundreds of decodes per 10s window, peaks around 0.1-0.3 amplitude
- After first peer contact, hello frequency correctly slows down (from every 1 min to every 10-40 mins)

## 2. Claude-Negotiated Channel Selection -- Working

- After audio discovery, Claude is consulted to pick a communication channel
- Claude correctly chose **TCP** in all cases, reasoning:
  - Both agents support TCP (capabilities bit 0)
  - Lowest latency for localhost communication
  - No intermediary services needed
- Negotiation completes in ~8-9 seconds (single Claude API round-trip)

## 3. TCP Handshake -- Working

- After negotiation, agents connect via TCP and exchange `hello` / `hello_ack` JSON messages
- Both sides log: "Handshake complete! Agents are now connected."
- Peer names are correctly exchanged (mumma1 <-> mumma2)

## 4. OBP Dynamic Entity Exploration -- Working

- Both directions complete successfully (each agent takes both initiator and responder roles)
- The `agent_handshake` entity already exists on OBP (handled gracefully; 400 error treated as "may already exist")
- 9 CRUD endpoints discovered via `_links`:
  - Personal: list, create, read, update, delete
  - Public: list, read
  - Community: list, read
- Test records created via POST and verified via GET -- `matches=true` on both sides
- "OBP Exploration COMPLETE (success)" logged consistently

## 5. Repeated Discovery Cycles -- Working

- The discovery/handshake/exploration pattern repeats ~3 times in these logs as peers expire (60s timeout) and are re-discovered via audio
- Each cycle completes successfully with no errors
- No regressions observed across cycles

---

## Warnings (non-critical)

| Warning | Details | Impact |
|---------|---------|--------|
| MCP server unavailable | `localhost:8000` connection refused (MCP server not running) | None -- system gracefully falls back to direct HTTP and known management endpoints |
| Entity already exists (OBP-09002) | `agent_handshake` entity creation returns 400 on subsequent runs | None -- handled gracefully, proceeds to discover CRUD endpoints from existing entity |

## Observation: Record Accumulation

The `agent_handshake` table is accumulating many duplicate records across runs (46+ records visible in the read-back). There is no deduplication or cleanup between sessions. This is not a bug, but the table could grow unbounded over time. Consider adding:
- Deduplication on (agent_id, peer_id) pairs
- TTL / cleanup of old handshake records
- A check-before-create step to avoid redundant writes

---

## Log Files

- `/tmp/agent-discovery/mumma1.log` (173 lines)
- `/tmp/agent-discovery/mumma2.log` (168 lines)
